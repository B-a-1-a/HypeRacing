FROM node:18-alpine

WORKDIR /app

# Copy package files
COPY package.json ./

# Install node modules with npm
RUN npm install

# Copy the rest of the app
COPY . .

# Set environment variables - including all Firebase config
ENV NEXT_PUBLIC_LIVE_SOCKET_URL=ws://147.182.132.26:4000
ENV NEXT_PUBLIC_API_URL=http://147.182.132.26:4001
ENV SKIP_ENV_VALIDATION=1
ENV NEXT_TELEMETRY_DISABLED=1
ENV NODE_OPTIONS=--max_old_space_size=2048

# Firebase configuration
ENV NEXT_PUBLIC_FIREBASE_API_KEY=AIzaSyC2sLlSxUdDFDQ_iB8POQhBZMqgGXMIYJA
ENV NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=racebettingapp.firebaseapp.com
ENV NEXT_PUBLIC_FIREBASE_PROJECT_ID=racebettingapp
ENV NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=racebettingapp.firebasestorage.app
ENV NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=759480069787
ENV NEXT_PUBLIC_FIREBASE_APP_ID=1:759480069787:web:f98c3f144a034087d1603e
ENV NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=G-VLJWPH04M7

# Build the app with static export to avoid prerendering issues
RUN npm run build

# Set runtime environment variables
ENV NODE_ENV=production
ENV PORT=3000

# Expose the port
EXPOSE 3000

# Start the app
CMD ["npm", "start"]
